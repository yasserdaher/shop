<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>متجر رقمي store</title>
<link rel="stylesheet" href="/css/style.css" />
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #111; color: #eee; margin:0; padding:0; }
  header { background:#222; padding:10px 20px; text-align:center; font-size:24px; }
  .products { display:flex; flex-wrap: wrap; justify-content: center; gap:20px; padding:20px; }
  .product-card { background:#222; border-radius:10px; width:280px; box-shadow: 0 0 10px #0ff; padding:15px; transition: transform 0.3s ease; }
  .product-card:hover { transform: rotateY(15deg) scale(1.05); box-shadow: 0 0 15px #0ff; }
  .product-card img { width:100%; border-radius:8px; }
  .product-card h3 { margin:10px 0 5px; }
  .product-card p { font-size:14px; color:#bbb; min-height:50px; }
  .product-card .price { font-size:18px; color:#0ff; margin:10px 0; }
  .product-card button.buy-btn {
    display: inline-block;
    background: #0ff;
    color: #7c5757;
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .product-card button.buy-btn:hover {
    background: #00c;
    color: #fff;
  }
</style>
<script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <header>متجر ضاهر رقمي </header>
  <main>
    <div class="products">
      <% products.forEach(product => { %>
        <div class="product-card">
          <img src="<%= product.image %>" alt="صوره" />
          <h3><%= product.title %></h3>
          <p><%= product.description %></p>
          <div class="price"><%= product.price %> $</div>
          <button class="buy-btn" data-product-id="<%= product.id %>">شراء الان</button>
        </div>
      <% }); %>
    </div>
  </main>

<script>
  const stripe = Stripe('pk_test_51RT8oO4Fl0WramqBEk8Ld2ZVIe7Y3jVYLEPERP4AsOEqLdKDFFkFVChcyDe4VesgV84Wn8Gw9Stz682tIpy81BVA00BxY2WrL4');

  document.querySelectorAll('.buy-btn').forEach(button => {
    button.addEventListener('click', () => {
      const productId = button.getAttribute('data-product-id');
      fetch('/create-checkout-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ productId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.error) {
          alert(data.error);
        } else {
          return stripe.redirectToCheckout({ sessionId: data.id });
        }
      })
      .then(result => {
        if (result && result.error) {
          alert(result.error.message);
        }
      })
      .catch(err => alert('��� ���: ' + err.message));
    });
  });
</script>

</body>
</html>